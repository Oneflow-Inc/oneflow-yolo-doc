
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.1.11">
    
    
      
        <title>5. æ¨¡å‹è®­ç»ƒ - oneflow-yolo-doc</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3754935a.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.f1a3b89f.min.css">
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          è·³è½¬è‡³
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="oneflow-yolo-doc" class="md-header__button md-logo" aria-label="oneflow-yolo-doc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            oneflow-yolo-doc
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              5. æ¨¡å‹è®­ç»ƒ
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="æœç´¢" placeholder="æœç´¢" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            æ­£åœ¨åˆå§‹åŒ–æœç´¢å¼•æ“
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../index.html" class="md-tabs__link">
      é¦–é¡µğŸ 
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../00_chapter/overview.html" class="md-tabs__link md-tabs__link--active">
        YOLOv5æ•™ç¨‹ğŸ“š
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../thesis_interpretation/00_yolo_history.html" class="md-tabs__link">
        è®ºæ–‡è§£è¯»
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="oneflow-yolo-doc" class="md-nav__button md-logo" aria-label="oneflow-yolo-doc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    oneflow-yolo-doc
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        é¦–é¡µğŸ 
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        YOLOv5æ•™ç¨‹ğŸ“š
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="YOLOv5æ•™ç¨‹ğŸ“š" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          YOLOv5æ•™ç¨‹ğŸ“š
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../00_chapter/overview.html" class="md-nav__link">
        1. one-yolov5 ç‰¹ç‚¹è§£æ
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../01_chapter/yolov5_network_structure_analysis.html" class="md-nav__link">
        2. YOLOv5 ç½‘ç»œç»“æ„è§£æ
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../02_chapter/how_to_prepare_yolov5_training_data.html" class="md-nav__link">
        3. å¦‚ä½•å‡†å¤‡YOLOv5æ¨¡å‹è®­ç»ƒæ•°æ®
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="quick_start.html" class="md-nav__link">
        4. å¿«é€Ÿå¼€å§‹
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          5. æ¨¡å‹è®­ç»ƒ
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="model_train.html" class="md-nav__link md-nav__link--active">
        5. æ¨¡å‹è®­ç»ƒ
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="ç›®å½•">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      ç›®å½•
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    é¡¹ç›®ç»“æ„é¢„è§ˆ ğŸ 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coco" class="md-nav__link">
    è®­ç»ƒæŒ‡ä»¤(ä½¿ç”¨cocoæ•°æ®é›†ä¸ºğŸŒ°)
  </a>
  
    <nav class="md-nav" aria-label="è®­ç»ƒæŒ‡ä»¤(ä½¿ç”¨cocoæ•°æ®é›†ä¸ºğŸŒ°)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    ğŸ“Œä¸¤ç§è®­ç»ƒæ–¹å¼
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gpu" class="md-nav__link">
    ğŸ“Œå•GPUè®­ç»ƒ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gpu_1" class="md-nav__link">
    ğŸ“Œå¤šGPUè®­ç»ƒ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#syncbatchnorm" class="md-nav__link">
    ğŸ“Œä½¿ç”¨SyncBatchNorm
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    è®­ç»ƒç»“æœğŸŒŸ
  </a>
  
    <nav class="md-nav" aria-label="è®­ç»ƒç»“æœğŸŒŸ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    ğŸ“Œæœ¬åœ°æ—¥å¿—
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#valpy" class="md-nav__link">
    æ¨¡å‹æµ‹è¯•(val.py) ğŸ”¥
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    æ¨¡å‹é¢„æµ‹ğŸ”¥
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    è®­ç»ƒæŠ€å·§ğŸ”¥
  </a>
  
    <nav class="md-nav" aria-label="è®­ç»ƒæŠ€å·§ğŸ”¥">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    ğŸ“Œæ¨¡å‹é€‰æ‹©
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    ğŸ“Œè®­ç»ƒé…ç½®
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="TTA.html" class="md-nav__link">
        6. æµ‹è¯•æ—¶å¢å¼º (TTA)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="model_ensembling.html" class="md-nav__link">
        7. æ¨¡å‹èåˆ (Model Ensembling)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="loading_model_from_oneflowhub.html" class="md-nav__link">
        8. ä» OneFlow Hub åŠ è½½ YOLOv5
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../04_chapter/mosaic.html" class="md-nav__link">
        9. æ•°æ®å¢å¼º
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../05_chapter/rectangular_reasoning.html" class="md-nav__link">
        10. çŸ©å½¢æ¨ç†
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../05_chapter/iou_in-depth_analysis.html" class="md-nav__link">
        11. IOUæ·±å…¥è§£æ
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../05_chapter/map_analysis.html" class="md-nav__link">
        12. æ¨¡å‹ç²¾ç¡®åº¦è¯„ä¼°
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../06_chapter/export_onnx_tflite_tensorrt.html" class="md-nav__link">
        13. æ¨¡å‹å¯¼å‡º
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        è®ºæ–‡è§£è¯»
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="è®ºæ–‡è§£è¯»" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          è®ºæ–‡è§£è¯»
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../thesis_interpretation/00_yolo_history.html" class="md-nav__link">
        history
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../thesis_interpretation/01_yolo.html" class="md-nav__link">
        YOLOv1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../thesis_interpretation/02_yolo.html" class="md-nav__link">
        YOLOv2
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../thesis_interpretation/03_yolo.html" class="md-nav__link">
        YOLOv3
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../thesis_interpretation/04_yolo.html" class="md-nav__link">
        YOLOv4
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../thesis_interpretation/06_yolo.html" class="md-nav__link">
        YOLOv6
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="ç›®å½•">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      ç›®å½•
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    é¡¹ç›®ç»“æ„é¢„è§ˆ ğŸ 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coco" class="md-nav__link">
    è®­ç»ƒæŒ‡ä»¤(ä½¿ç”¨cocoæ•°æ®é›†ä¸ºğŸŒ°)
  </a>
  
    <nav class="md-nav" aria-label="è®­ç»ƒæŒ‡ä»¤(ä½¿ç”¨cocoæ•°æ®é›†ä¸ºğŸŒ°)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    ğŸ“Œä¸¤ç§è®­ç»ƒæ–¹å¼
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gpu" class="md-nav__link">
    ğŸ“Œå•GPUè®­ç»ƒ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gpu_1" class="md-nav__link">
    ğŸ“Œå¤šGPUè®­ç»ƒ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#syncbatchnorm" class="md-nav__link">
    ğŸ“Œä½¿ç”¨SyncBatchNorm
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    è®­ç»ƒç»“æœğŸŒŸ
  </a>
  
    <nav class="md-nav" aria-label="è®­ç»ƒç»“æœğŸŒŸ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    ğŸ“Œæœ¬åœ°æ—¥å¿—
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#valpy" class="md-nav__link">
    æ¨¡å‹æµ‹è¯•(val.py) ğŸ”¥
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    æ¨¡å‹é¢„æµ‹ğŸ”¥
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    è®­ç»ƒæŠ€å·§ğŸ”¥
  </a>
  
    <nav class="md-nav" aria-label="è®­ç»ƒæŠ€å·§ğŸ”¥">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    ğŸ“Œæ¨¡å‹é€‰æ‹©
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    ğŸ“Œè®­ç»ƒé…ç½®
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>5. æ¨¡å‹è®­ç»ƒ</h1>
                
                <p>ğŸ“¢ å£°æ˜:Model Train(ä»¥cocoæ•°æ®é›†ä¸ºä¾‹) </p>
<h2 id="_1">é¡¹ç›®ç»“æ„é¢„è§ˆ ğŸ </h2>
<p><img alt="imgs" src="model_train_imgs/one-yolov5.png" /></p>
<h2 id="coco">è®­ç»ƒæŒ‡ä»¤(ä½¿ç”¨cocoæ•°æ®é›†ä¸ºğŸŒ°)</h2>
<h3 id="_2">ğŸ“Œä¸¤ç§è®­ç»ƒæ–¹å¼</h3>
<ol>
<li>å¸¦æƒé‡è®­ç»ƒ ğŸš€
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>$ python path/to/train.py --data coco.yaml --weights yolov5s --img 640
</code></pre></div></li>
<li>ä¸å¸¦æƒé‡è®­ç»ƒ ğŸš€
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>$ python path/to/train.py --data coco.yaml --weights &#39;&#39; --cfg yolov5s.yaml --img 640
</code></pre></div></li>
</ol>
<h3 id="gpu">ğŸ“Œå•GPUè®­ç»ƒ</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>$ python train.py  --data coco.yaml --weights yolov5s  --device 0
</code></pre></div>
<h3 id="gpu_1">ğŸ“Œå¤šGPUè®­ç»ƒ</h3>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>$ python -m oneflow.distributed.launch --nproc_per_node 2 train.py --batch 64 --data coco.yaml --weights yolov5s --device 0,1
</code></pre></div>
æ³¨æ„âš ï¸ï¼š</p>
<ul>
<li>
<p>--nproc_per_node  æŒ‡å®šè¦ä½¿ç”¨å¤šå°‘GPUã€‚ä¸¾ä¸ªä¾‹å­ğŸŒ°:åœ¨ä¸Šé¢ğŸ‘† å¤šGPUè®­ç»ƒæŒ‡ä»¤ä¸­å®ƒæ˜¯2ã€‚</p>
</li>
<li>
<p>--batch æ‰¹å¤„ç†æ•°é‡ï¼ˆ<em>å³ä¸€æ¬¡è®­ç»ƒæ‰€é€‰å–çš„æ ·æœ¬æ•°</em>)ã€‚å®ƒå°†å¹³å‡åˆ†é…ç»™æ¯ä¸ªGPUã€‚åœ¨ä¸Šé¢ğŸ‘†çš„ç¤ºä¾‹ä¸­ï¼Œæ¯GPUåˆ†é… 64/2ï¼32 ä¸ªæ ·æœ¬ã€‚</p>
</li>
<li>
<p>ä¸Šé¢çš„ä»£ç é»˜è®¤ä½¿ç”¨GPU 0â€¦ï¼ˆN-1ï¼‰ã€‚ä½¿ç”¨ç‰¹å®šçš„GPUğŸ¤”ï¸ï¼Ÿ
å¯ä»¥é€šè¿‡ç®€å•åœ¨ --device åè·ŸæŒ‡å®šGPUæ¥å®ç°ã€‚ã€Œæ¡ˆä¾‹ğŸŒ°ã€ï¼Œåœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨GPU 2,3ã€‚
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>$ python -m oneflow.distributed.launch --nproc_per_node 2 train.py --batch 64 --data coco.yaml --cfg yolov5s.yaml --weights &#39;&#39; --device 2,3
</code></pre></div></p>
</li>
</ul>
<h3 id="syncbatchnorm">ğŸ“Œä½¿ç”¨SyncBatchNorm</h3>
<p><a href="https://pytorch.org/docs/master/generated/torch.nn.SyncBatchNorm.html">SyncBatchNorm</a>å¯ä»¥æé«˜å¤šgpuè®­ç»ƒçš„å‡†ç¡®æ€§ï¼Œä½†ä¼šæ˜¾è‘—é™ä½è®­ç»ƒé€Ÿåº¦ã€‚å®ƒä»…é€‚ç”¨äºå¤šGPU DistributedDataParallel è®­ç»ƒã€‚</p>
<p>å»ºè®®æœ€å¥½åœ¨æ¯ä¸ªGPUä¸Šçš„æ ·æœ¬æ•°é‡è¾ƒå°ï¼ˆ<em>æ ·æœ¬æ•°é‡&lt;=8</em>ï¼‰æ—¶ä½¿ç”¨ã€‚</p>
<p>è¦ä½¿ç”¨SyncBatchNormï¼Œåªéœ€å°†æ·»åŠ  --sync-bn å‚æ•°é€‰é¡¹ï¼Œå…·ä½“ã€Œæ¡ˆä¾‹ğŸŒ°ã€å¦‚ä¸‹:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="err">$</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">oneflow</span><span class="o">.</span><span class="n">distributed</span><span class="o">.</span><span class="n">launch</span> <span class="o">--</span><span class="n">nproc_per_node</span> <span class="mi">2</span> <span class="n">train</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">batch</span> <span class="mi">64</span> <span class="o">--</span><span class="n">data</span> <span class="n">coco</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">cfg</span> <span class="n">yolov5s</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">weights</span> <span class="s1">&#39;&#39;</span> <span class="o">--</span><span class="n">sync</span><span class="o">-</span><span class="n">bn</span>
</code></pre></div>
<p>ğŸ“¢ æ›´å¤šå‚æ•°è§£æè¯¦è§  <a href="#table_31">é™„ä»¶è¡¨3.1</a>ã€‚</p>
<h2 id="_3">è®­ç»ƒç»“æœğŸŒŸ</h2>
<h3 id="_4">ğŸ“Œæœ¬åœ°æ—¥å¿—</h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç»“æœéƒ½è®°å½•ä¸ºruns/trainï¼Œå¹¶ä¸ºæ¯ä¸ªæ–°è®­ç»ƒåˆ›å»ºä¸€ä¸ªæ–°çš„è®­ç»ƒç»“æœç›®å½•ï¼Œå¦‚runs/train/exp2ã€runs/train/exp3ç­‰ã€‚æŸ¥çœ‹è®­ç»ƒå’Œæµ‹è¯•JPGä»¥æŸ¥çœ‹ mosaics, labels, predictions and augmentation æ•ˆæœã€‚
æ³¨æ„ï¼šMosaic Dataloader ç”¨äºè®­ç»ƒï¼ˆå¦‚ä¸‹æ‰€ç¤ºï¼‰ï¼Œè¿™æ˜¯Ultralyticså‘è¡¨çš„æ–°æ¦‚å¿µï¼Œé¦–æ¬¡å‡ºç°åœ¨<a href="https://arxiv.org/abs/2004.10934">YOLOv4</a>ä¸­ã€‚</p>
<p><strong>train_batch0.jpg</strong> æ˜¾ç¤º batch ä¸º 0 çš„ (mosaics and labels):</p>
<p><img alt="img" src="https://user-images.githubusercontent.com/26833433/83667642-90fcb200-a583-11ea-8fa3-338bbf7da194.jpeg" /></p>
<p>val_batch0_labels.jpg å±•ç¤ºæµ‹è¯• batch ä¸º 0 çš„labels:</p>
<p><img alt="img" src="https://user-images.githubusercontent.com/26833433/83667626-8c37fe00-a583-11ea-997b-0923fe59b29b.jpeg" /></p>
<p>val_batch0_pred.jpg å±•ç¤ºæµ‹è¯• batch ä¸º 0 predictions(é¢„æµ‹):
<img alt="img" src="https://user-images.githubusercontent.com/26833433/83667635-90641b80-a583-11ea-8075-606316cebb9c.jpeg" /></p>
<p>è®­ç»ƒè®­æŸå¤±å’Œæ€§èƒ½çš„æŒ‡æ ‡æœ‰è®°å½•åˆ°Tensorboardå’Œè‡ªå®šä¹‰ç»“æœä¸­<strong>results.csvæ—¥å¿—æ–‡ä»¶</strong>ï¼Œè®­ç»ƒè®­å®Œæˆåä½œä¸ºç»“æœç»˜åˆ¶ results.pngå¦‚ä¸‹ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å±•ç¤ºäº†åœ¨COCO128ä¸Šè®­ç»ƒçš„YOLOV5ç»“æœ
- ä»é›¶å¼€å§‹è®­ç»ƒ (è“è‰²)ã€‚
- åŠ è½½é¢„è®­ç»ƒæƒé‡ --weights yolov5s (æ©™è‰²)ã€‚</p>
<p><img alt="img" src="https://user-images.githubusercontent.com/26833433/97808309-8182b180-1c66-11eb-8461-bffe1a79511d.png" /></p>
<p>å…·ä½“çš„æŒ‡æ ‡åˆ†æè¯¦è§æ–‡ç« <a href="https://start.oneflow.org/oneflow-yolo-doc/tutorials/05_chapter/map_analysis.html">ã€Šæ¨¡å‹ç²¾ç¡®åº¦è¯„ä¼°ã€‹</a> </p>
<h2 id="valpy">æ¨¡å‹æµ‹è¯•(val.py) ğŸ”¥</h2>
<p>ä¸‹é¢çš„å‘½ä»¤æ˜¯åœ¨COCO val2017æ•°æ®é›†ä¸Šä»¥640åƒç´ çš„å›¾åƒå¤§å°æµ‹è¯• <code>YOLOv5x</code> æ¨¡å‹ã€‚å…¶å®ƒå¯ç”¨é€‰é¡¹æ˜¯ <code>yolov5n</code> ï¼Œ<code>yolov5m</code>ï¼Œ<code>yolov5s</code>ï¼Œ<code>yolov5l</code> ï¼Œä»¥åŠä»–ä»¬çš„ P6 å¯¹åº”é¡¹æ¯”å¦‚ <code>yolov5s6</code> ï¼Œæˆ–è€…ä½ è‡ªå®šä¹‰çš„æ¨¡å‹ï¼Œå³ <code>runs/exp/weights/best</code> ã€‚æœ‰å…³å¯ç”¨æ¨¡å‹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æˆ‘ä»¬çš„<a href="https://github.com/Oneflow-Inc/one-yolov5#%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A3%80%E6%9F%A5%E7%82%B9">README-TABLE</a></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="err">$</span> <span class="n">python</span> <span class="n">val</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">weights</span> <span class="n">yolov5x</span> <span class="o">--</span><span class="n">data</span> <span class="n">coco</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">img</span> <span class="mi">640</span> 
</code></pre></div>
<h2 id="_5">æ¨¡å‹é¢„æµ‹ğŸ”¥</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">python</span> <span class="n">detect</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">weights</span> <span class="n">yolov5s</span> <span class="o">--</span><span class="n">img</span> <span class="mi">832</span> 
</code></pre></div>
<h2 id="_6">è®­ç»ƒæŠ€å·§ğŸ”¥</h2>
<p>ğŸ“¢ å£°æ˜ï¼šå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ<strong>åªè¦æ•°æ®é›†è¶³å¤Ÿå¤§ä¸”æ ‡è®°è‰¯å¥½</strong>ï¼Œå°±å¯ä»¥åœ¨ä¸æ”¹å˜æ¨¡å‹æˆ–è®­ç»ƒè®¾ç½®çš„æƒ…å†µä¸‹è·å¾—è‰¯å¥½çš„ç»“æœã€‚
å¦‚æœä¸€å¼€å§‹ä½ æ²¡æœ‰å¾—åˆ°å¥½çš„ç»“æœï¼Œä½ å¯ä»¥é‡‡å–ä¸€äº›æ­¥éª¤æ¥æ”¹è¿›ï¼Œä½†æˆ‘ä»¬å§‹ç»ˆå»ºè®®ç”¨æˆ·åœ¨è€ƒè™‘ä»»ä½•æ›´æ”¹ä¹‹å‰å…ˆä½¿ç”¨æ‰€æœ‰é»˜è®¤è®¾ç½®è¿›è¡Œä¸€æ¬¡è®­ç»ƒã€‚è¿™æœ‰åŠ©äºå»ºç«‹è¯„ä¼°åŸºå‡†å’Œå‘ç°éœ€è¦æ”¹è¿›çš„åœ°æ–¹ ğŸš€ã€‚</p>
<h3 id="_7">ğŸ“Œæ¨¡å‹é€‰æ‹©</h3>
<p>ç±»ä¼¼äºYOLOv5xå’ŒYOLOv5x6çš„å¤§å‹æ¨¡å‹åœ¨å‡ ä¹æ‰€æœ‰æƒ…å†µä¸‹éƒ½ä¼šäº§ç”Ÿæ›´å¥½çš„ç»“æœï¼Œä½†å‚æ•°æ›´å¤šï¼Œéœ€è¦æ›´å¤šçš„CUDAå†…å­˜è¿›è¡Œè®­ç»ƒï¼Œè¿è¡Œé€Ÿåº¦è¾ƒæ…¢ã€‚</p>
<p>å¯¹äºç§»åŠ¨éƒ¨ç½²ï¼Œæˆ‘ä»¬æ¨èYOLOv5s/mï¼Œå¯¹äºäº‘éƒ¨ç½²ï¼Œæˆ‘ä»¬å»ºè®®YOLOV5l/xã€‚</p>
<p>æœ‰å…³æ‰€æœ‰æ¨¡å‹çš„å®Œæ•´æ¯”è¾ƒï¼Œè¯·å‚é˜…<a href="https://github.com/Oneflow-Inc/one-yolov5#%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A3%80%E6%9F%A5%E7%82%B9">è¯¦ç»†è¡¨</a></p>
<p><img alt="imgs" src="https://github.com/Oneflow-Inc/one-yolov5/releases/download/v1.0/model_comparison.png" /></p>
<ul>
<li>ä»é¢„å…ˆè®­ç»ƒçš„æƒé‡å¼€å§‹è®­ç»ƒã€‚å»ºè®®ç”¨äºä¸­å°å‹æ•°æ®é›†ï¼ˆå³<a href="https://github.com/ultralytics/yolov5/blob/master/data/VOC.yaml">VOC</a>ã€<a href="https://github.com/ultralytics/yolov5/blob/master/data/VisDrone.yaml">VisDrone</a>ã€<a href="https://github.com/ultralytics/yolov5/blob/master/data/GlobalWheat2020.yaml">GlobalWheat</a>ï¼‰ã€‚å°†æ¨¡å‹çš„åç§°ä¼ é€’ç»™--weightså‚æ•°ã€‚æ¨¡å‹è‡ªåŠ¨ä»<a href="https://github.com/ultralytics/yolov5/releases">latest YOLOv5 releasse</a> ä¸‹è½½ ã€‚</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">python</span> <span class="n">train</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">data</span> <span class="n">custom</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">weights</span> <span class="n">yolov5s</span> 
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>                                             <span class="n">yolov5m</span> 
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>                                             <span class="n">yolov5l</span> 
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>                                             <span class="n">yolov5x</span> 
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>                                             <span class="n">custom_pretrained</span> <span class="c1"># è‡ªå®šä¹‰çš„ç½‘ç»œç»“æ„æ–‡ä»¶</span>
</code></pre></div>
<ul>
<li>ä»å¤´å¼€å§‹è®­ç»ƒçš„è¯ï¼Œæ¨èç”¨å¤§çš„æ•°æ®é›†(å³ COCOã€Objects365ã€OIv6 ) --cfg åä¼ é€’æ‚¨æ„Ÿå…´è¶£çš„ç½‘ç»œç»“æ„æ–‡ä»¶å‚æ•° ä»¥åŠç©ºçš„--weights ' ' å‚æ•°ï¼š</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">python</span> <span class="n">train</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">data</span> <span class="n">custom</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">weights</span> <span class="s1">&#39;&#39;</span> <span class="o">--</span><span class="n">cfg</span> <span class="n">yolov5s</span><span class="o">.</span><span class="n">yaml</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>                                                      <span class="n">yolov5m</span><span class="o">.</span><span class="n">yaml</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>                                                      <span class="n">yolov5l</span><span class="o">.</span><span class="n">yaml</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>                                                      <span class="n">yolov5x</span><span class="o">.</span><span class="n">yaml</span>
</code></pre></div>
<h3 id="_8">ğŸ“Œè®­ç»ƒé…ç½®</h3>
<p>åœ¨ä¿®æ”¹ä»»ä½•å†…å®¹ä¹‹å‰ï¼Œé¦–å…ˆä½¿ç”¨é»˜è®¤è®¾ç½®è¿›è¡Œè®­ç»ƒï¼Œä»¥å»ºç«‹æ€§èƒ½åŸºçº¿ã€‚è®­ç»ƒå‚æ•°çš„å®Œæ•´åˆ—è¡¨,èƒ½å¤Ÿå‘ç°åœ¨train.pyæ–‡ä»¶ä¸­ã€‚</p>
<ul>

  <li> Epochs : é»˜è®¤è®­ç»ƒ300ä¸ªepochsã€‚å¦‚æœæ—©æœŸè¿‡æ‹Ÿåˆï¼Œåˆ™å¯ä»¥å‡å°‘è®­ç»ƒã€‚å¦‚æœåœ¨300ä¸ªå‘¨æœŸåæœªå‘ç”Ÿè¿‡æ‹Ÿåˆï¼Œåˆ™å¯ä»¥è®­ç»ƒæ›´é•¿ï¼Œæ¯”å¦‚600ã€1200ä¸ªepochsã€‚ </li>

  <li> Image size: COCOä»¥ --img 640,çš„åˆ†è¾¨ç‡è¿›è¡Œè®­ç»ƒï¼Œä½†ç”±äºæ•°æ®é›†ä¸­æœ‰å¤§é‡çš„å°å¯¹è±¡ï¼Œå®ƒå¯ä»¥ä»æ›´é«˜åˆ†è¾¨ç‡ï¼ˆå¦‚--img 1280ï¼‰çš„è®­ç»ƒä¸­è®­ç»ƒã€‚ å¦‚æœæœ‰è®¸å¤šå°å¯¹è±¡ï¼Œåˆ™è‡ªå®šä¹‰æ•°æ®é›†å°†ä»æ›´é«˜åˆ†è¾¨ç‡çš„è®­ç»ƒä¸­è·ç›Šã€‚æœ€å¥½çš„æ¨æ–­ç»“æœæ˜¯åœ¨ç›¸åŒçš„--img å¤„è·å¾—çš„ ï¼Œå³å¦‚æœåœ¨-img 1280å¤„è¿›è¡Œè®­ç»ƒï¼Œä¹Ÿåº”è¯¥åœ¨--img 1280å¤„è¿›è¡Œæµ‹è¯•å’Œæ£€æµ‹ã€‚</li>

  <li> Batch Size: ä½¿ç”¨æ›´å¤§çš„ --batch-size ã€‚èƒ½å¤Ÿæœ‰æ•ˆç¼“è§£å°æ ·æœ¬æ•°äº§ç”Ÿçš„batchnormç»Ÿè®¡çš„é”™è¯¯ã€‚</li>

<li> Hyperparametersï¼š é»˜è®¤è¶…å‚æ•°åœ¨hyp.scratch-low.yamlæ–‡ä»¶ä¸­ã€‚æˆ‘ä»¬å»ºè®®æ‚¨åœ¨è€ƒè™‘ä¿®æ”¹ä»»ä½•è¶…å‚æ•°ä¹‹å‰ï¼Œå…ˆä½¿ç”¨é»˜è®¤è¶…å‚æ•°è¿›è¡Œè®­ç»ƒã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¢åŠ å¢å¼ºè¶…å‚æ•°å°†å‡å°‘å’Œå»¶è¿Ÿè¿‡åº¦æ‹Ÿåˆï¼Œå…è®¸æ›´é•¿çš„è®­ç»ƒå’Œå¾—åˆ°æ›´é«˜mAPå€¼ã€‚å‡å°‘æŸè€—åˆ†é‡å¢ç›Šè¶…å‚æ•°ï¼Œå¦‚hyp['obj']ï¼Œå°†æœ‰åŠ©äºå‡å°‘è¿™äº›ç‰¹å®šæŸè€—åˆ†é‡ä¸­çš„è¿‡åº¦æ‹Ÿåˆã€‚æœ‰å…³ä¼˜åŒ–è¿™äº›è¶…å‚æ•°çš„è‡ªåŠ¨åŒ–æ–¹æ³•ï¼Œè¯·å‚é˜…æˆ‘ä»¬çš„ <a href="https://github.com/ultralytics/yolov5/issues/607"> ã€Šè¶…å‚æ•°æ¼”åŒ–æ•™ç¨‹ã€‹</a>ã€‚</li>




## æ‹“å±• ğŸ“˜

### ğŸ“Œä½¿ç”¨å¤šæœºè®­ç»ƒ
è¿™ä»…é€‚ç”¨äºå¤šGPUåˆ†å¸ƒå¼æ•°æ®å¹¶è¡Œè®­ç»ƒã€‚

åœ¨è®­ç»ƒä¹‹å‰ï¼Œç¡®ä¿æ‰€æœ‰æœºå™¨ä¸Šçš„æ–‡ä»¶éƒ½ç›¸åŒï¼Œæ•°æ®é›†ã€ä»£ç åº“ç­‰ã€‚ä¹‹åï¼Œç¡®ä¿æœºå™¨å¯ä»¥ç›¸äº’é€šä¿¡ã€‚

æ‚¨å¿…é¡»é€‰æ‹©ä¸€å°ä¸»æœºå™¨ï¼ˆå…¶ä»–æœºå™¨å°†ä¸ä¹‹å¯¹è¯ï¼‰ã€‚è®°ä¸‹å®ƒçš„åœ°å€ï¼ˆmaster_addrï¼‰å¹¶é€‰æ‹©ä¸€ä¸ªç«¯å£ï¼ˆmaster-portï¼‰ã€‚å¯¹äºä¸‹é¢çš„ç¤ºä¾‹ï¼Œå°†ä½¿ç”¨master_addr=192.168.1.1å’Œmaster_ port=1234ã€‚

è¦ä½¿ç”¨å®ƒï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># On master machine 0</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="err">$</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">oneflow</span><span class="o">.</span><span class="n">distributed</span><span class="o">.</span><span class="n">launch</span> <span class="o">--</span><span class="n">nproc_per_node</span> <span class="n">G</span> <span class="o">--</span><span class="n">nnodes</span> <span class="n">N</span> <span class="o">--</span><span class="n">node_rank</span> <span class="mi">0</span> <span class="o">--</span><span class="n">master_addr</span> <span class="s2">&quot;192.168.1.1&quot;</span> <span class="o">--</span><span class="n">master_port</span> <span class="mi">1234</span> <span class="n">train</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">batch</span> <span class="mi">64</span> <span class="o">--</span><span class="n">data</span> <span class="n">coco</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">cfg</span> <span class="n">yolov5s</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">weights</span> <span class="s1">&#39;&#39;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># On machine R</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="err">$</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">oneflow</span><span class="o">.</span><span class="n">distributed</span><span class="o">.</span><span class="n">launch</span> <span class="o">--</span><span class="n">nproc_per_node</span> <span class="n">G</span> <span class="o">--</span><span class="n">nnodes</span> <span class="n">N</span> <span class="o">--</span><span class="n">node_rank</span> <span class="n">R</span> <span class="o">--</span><span class="n">master_addr</span> <span class="s2">&quot;192.168.1.1&quot;</span> <span class="o">--</span><span class="n">master_port</span> <span class="mi">1234</span> <span class="n">train</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">batch</span> <span class="mi">64</span> <span class="o">--</span><span class="n">data</span> <span class="n">coco</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">cfg</span> <span class="n">yolov5s</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">weights</span> <span class="s1">&#39;&#39;</span>
</code></pre></div>

å…¶ä¸­Gæ˜¯æ¯å°æœºå™¨çš„GPUæ•°é‡ï¼ŒNæ˜¯æœºå™¨æ•°é‡ï¼ŒRæ˜¯ä»0åˆ°ï¼ˆN-1ï¼‰çš„æœºå™¨æ•°é‡ã€‚

å‡è®¾æˆ‘æœ‰ä¸¤å°æœºå™¨ï¼Œæ¯å°æœºå™¨æœ‰ä¸¤ä¸ªGPUï¼Œå¯¹äºä¸Šé¢çš„æƒ…å†µï¼ŒG=2ï¼ŒN=2ï¼ŒR=1ã€‚

åœ¨è¿æ¥æ‰€æœ‰Nå°æœºå™¨ä¹‹å‰ï¼Œè®­ç»ƒä¸ä¼šå¼€å§‹ã€‚è¾“å‡ºå°†ä»…æ˜¾ç¤ºåœ¨ä¸»æœºä¸Šï¼

#### æ³¨æ„âš ï¸
- oneflowç›®å‰ä¸æ”¯æŒwindowså¹³å°
- --batch å¿…é¡»æ˜¯GPUæ•°é‡çš„å€æ•°ã€‚
- GPU 0 å°†æ¯”å…¶ä»–GPUå ç”¨ç•¥å¤šçš„å†…å­˜ï¼Œå› ä¸ºå®ƒç»´æŠ¤EMAå¹¶è´Ÿè´£æ£€æŸ¥ç‚¹ç­‰ã€‚
- å¦‚æœæ‚¨å¾—åˆ° **RuntimeError: Address already in use** ï¼Œå¯èƒ½æ˜¯å› ä¸ºæ‚¨ä¸€æ¬¡æ­£åœ¨è¿è¡Œå¤šä¸ªåŸ¹è®­ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªéœ€é€šè¿‡æ·»åŠ --master_portæ¥ä½¿ç”¨ä¸åŒçš„ç«¯å£å·ï¼Œå¦‚ä¸‹æ‰€ç¤º
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="err">$</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">oneflow</span><span class="o">.</span><span class="n">distributed</span><span class="o">.</span><span class="n">launch</span> <span class="o">--</span><span class="n">master_port</span> <span class="mi">1234</span> <span class="o">--</span><span class="n">nproc_per_node</span> <span class="mi">2</span> <span class="o">...</span>
</code></pre></div>
#### ç»“æœğŸ’¡
DDP åˆ†æç»“æœåœ¨[AWS EC2 P4d instance]( https://github.com/Oneflow-Inc/one-yolov5/wiki/AWS-Quickstart) with 8x A100 SXM4-40GB for YOLOv5l for 1 COCO epoch.
####  é…ç½®ä»£ç âš¡
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1"># prepare</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">t</span><span class="o">=</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Oneflow</span><span class="o">-</span><span class="n">Inc</span><span class="o">/</span><span class="n">one</span><span class="o">-</span><span class="n">yolov5</span><span class="p">:</span><span class="n">latest</span> <span class="o">&amp;&amp;</span> <span class="n">sudo</span> <span class="n">docker</span> <span class="n">pull</span> <span class="err">$</span><span class="n">t</span> <span class="o">&amp;&amp;</span> <span class="n">sudo</span> <span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="o">--</span><span class="n">ipc</span><span class="o">=</span><span class="n">host</span> <span class="o">--</span><span class="n">gpus</span> <span class="nb">all</span> <span class="o">-</span><span class="n">v</span> <span class="s2">&quot;$(pwd)&quot;</span><span class="o">/</span><span class="n">coco</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">coco</span> <span class="err">$</span><span class="n">t</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">pre</span> <span class="n">oneflow</span> <span class="o">-</span><span class="n">f</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">staging</span><span class="o">.</span><span class="n">oneflow</span><span class="o">.</span><span class="n">info</span><span class="o">/</span><span class="n">branch</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">cu112</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="n">cd</span> <span class="o">..</span> <span class="o">&amp;&amp;</span> <span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="n">app</span> <span class="o">&amp;&amp;</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Oneflow</span><span class="o">-</span><span class="n">Inc</span><span class="o">/</span><span class="n">one</span><span class="o">-</span><span class="n">yolov5</span> <span class="o">-</span><span class="n">b</span> <span class="n">master</span> <span class="n">app</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> <span class="n">app</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="n">cp</span> <span class="n">data</span><span class="o">/</span><span class="n">coco</span><span class="o">.</span><span class="n">yaml</span> <span class="n">data</span><span class="o">/</span><span class="n">coco_profile</span><span class="o">.</span><span class="n">yaml</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="c1"># profile</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="n">python</span> <span class="n">train</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">batch</span><span class="o">-</span><span class="n">size</span> <span class="mi">16</span> <span class="o">--</span><span class="n">data</span> <span class="n">coco_profile</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">weights</span> <span class="n">yolov5l</span>  <span class="o">--</span><span class="n">epochs</span> <span class="mi">1</span> <span class="o">--</span><span class="n">device</span> <span class="mi">0</span> 
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">oneflow</span><span class="o">.</span><span class="n">distributed</span><span class="o">.</span><span class="n">launch</span> <span class="o">--</span><span class="n">nproc_per_node</span> <span class="mi">2</span> <span class="n">train</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">batch</span><span class="o">-</span><span class="n">size</span> <span class="mi">32</span> <span class="o">--</span><span class="n">data</span> <span class="n">coco_profile</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">weights</span> <span class="n">yolov5l</span>  <span class="o">--</span><span class="n">epochs</span> <span class="mi">1</span> <span class="o">--</span><span class="n">device</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span>   
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">oneflow</span><span class="o">.</span><span class="n">distributed</span><span class="o">.</span><span class="n">launch</span> <span class="o">--</span><span class="n">nproc_per_node</span> <span class="mi">4</span> <span class="n">train</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">batch</span><span class="o">-</span><span class="n">size</span> <span class="mi">64</span> <span class="o">--</span><span class="n">data</span> <span class="n">coco_profile</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">weights</span> <span class="n">yolov5l</span>  <span class="o">--</span><span class="n">epochs</span> <span class="mi">1</span> <span class="o">--</span><span class="n">device</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span>  
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">oneflow</span><span class="o">.</span><span class="n">distributed</span><span class="o">.</span><span class="n">launch</span> <span class="o">--</span><span class="n">nproc_per_node</span> <span class="mi">8</span> <span class="n">train</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">batch</span><span class="o">-</span><span class="n">size</span> <span class="mi">128</span> <span class="o">--</span><span class="n">data</span> <span class="n">coco_profile</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">weights</span> <span class="n">yolov5l</span>  <span class="o">--</span><span class="n">epochs</span> <span class="mi">1</span> <span class="o">--</span><span class="n">device</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span>
</code></pre></div>

<a href="https://github.com/Oneflow-Inc/one-yolov5" target="blank"  >
ğŸ“¢ å¿«æ¥ç»™æˆ‘Starå‘€ğŸ˜Š~
<img src="https://oneflow-static.oss-cn-beijing.aliyuncs.com/one-yolo/document/concluding_remarks.gif" align="center">
</a>




## é™„ä»¶


 <span id="table_31"> è¡¨3.1</span> 
 è¡¨3.1 : [train.pyå‚æ•°è§£æè¡¨](https://github.com/Oneflow-Inc/one-yolov5/blob/e91659e981da258b8e8d9b5ad4fd27e6e31d04d4/train.py#L478-L566)

| å‚æ•°              | help                                                | å¸®åŠ©                                                                                             |
|-------------------|-----------------------------------------------------|------------------------------------------------------------------------------------------------|
| --weight          | initial weights path                                | åŠ è½½çš„æƒé‡æ–‡ä»¶è·¯å¾„                                                                               |
| --cfg             | model.yaml path                                     | æ¨¡å‹é…ç½®æ–‡ä»¶ï¼Œç½‘ç»œç»“æ„ è·¯å¾„                                                                       |
| --data            | dataset.yaml path                                   | æ•°æ®é›†é…ç½®æ–‡ä»¶ï¼Œæ•°æ®é›†è·¯å¾„                                                                        |
| --hyp             | hyperparameters path                                | è¶…å‚æ•°æ–‡ä»¶ è·¯å¾„                                                                                  |
| --epochs          | Total training rounds                               | è®­ç»ƒæ€»è½®æ¬¡                                                                                       |
| --batch-size      | total batch size for all GPUs, -1 for autobatch     | ä¸€æ¬¡è®­ç»ƒæ‰€é€‰å–çš„æ ·æœ¬æ•°                                                                           |
| --imgsz           | train, val image size (pixels)                      | è¾“å…¥å›¾ç‰‡åˆ†è¾¨ç‡å¤§å°                                                                               |
| --rect            | rectangular training                                | æ˜¯å¦é‡‡ç”¨çŸ©å½¢è®­ç»ƒï¼Œé»˜è®¤False                                                                       |
| --resume          | resume most recent training                         | æ¥ç€æ‰“æ–­è®­ç»ƒä¸Šæ¬¡çš„ç»“æœæ¥ç€è®­ç»ƒ                                                                   |
| --nosave          | only save final checkpoint                          | åªä¿å­˜æœ€ç»ˆçš„æ¨¡å‹ï¼Œé»˜è®¤False                                                                       |
| --noautoanchor    | disable AutoAnchor                                  | ä¸è‡ªåŠ¨è°ƒæ•´anchorï¼Œé»˜è®¤False                                                                       |
| --noplots         | save no plot files                                  | ä¸ä¿å­˜æ‰“å°æ–‡ä»¶ï¼Œé»˜è®¤False                                                                         |
| --evolve          | evolve hyperparameters for x generations            | æ˜¯å¦è¿›è¡Œè¶…å‚æ•°è¿›åŒ–ï¼Œé»˜è®¤False                                                                     |
| --bucket          | gsutil bucket                                       | è°·æ­Œäº‘ç›˜bucketï¼Œä¸€èˆ¬ä¸ä¼šç”¨åˆ°                                                                      |
| --cache           | --cache images in "ram" (default) or "disk"         | æ˜¯å¦æå‰ç¼“å­˜å›¾ç‰‡åˆ°å†…å­˜ï¼Œä»¥åŠ å¿«è®­ç»ƒé€Ÿåº¦ï¼Œé»˜è®¤False                                                  |
| --device          | cuda device, i.e. 0 or 0,1,2,3 or cpu               | è®­ç»ƒçš„è®¾å¤‡ï¼Œcpuï¼›0(è¡¨ç¤ºä¸€ä¸ªgpuè®¾å¤‡cuda:0)ï¼›0,1,2,3(å¤šä¸ªgpuè®¾å¤‡)                                     |
| --multi-scale     | vary img-size +/- 50%%                              | æ˜¯å¦è¿›è¡Œå¤šå°ºåº¦è®­ç»ƒï¼Œé»˜è®¤False                                                                     |
| --single-cls      | train multi-class data as single-class              | æ•°æ®é›†æ˜¯å¦åªæœ‰ä¸€ä¸ªç±»åˆ«ï¼Œé»˜è®¤False                                                                 |
| --optimizer       | optimizer                                           | ä¼˜åŒ–å™¨                                                                                           |
| --sync-bn         | use SyncBatchNorm, only available in DDP mode       | æ˜¯å¦ä½¿ç”¨è·¨å¡åŒæ­¥BN,åœ¨DDPæ¨¡å¼ä½¿ç”¨                                                                 |
| --workers         | max dataloader workers (per RANK in DDP mode)       | dataloaderçš„æœ€å¤§workeræ•°é‡                                                                       |
| --project         | save to project path                                | ä¿å­˜åˆ°é¡¹ç›®ç»“æœåœ°å€                                                                               |
| --name            | save to project/name/                               | ä¿å­˜åˆ°é¡¹ç›®ç»“æœ/åç§°                                                                              |
| --exist-ok        | existing project/name ok, do not increment          | ç°æœ‰é¡¹ç›®/åç§°ç¡®å®šï¼Œä¸é€’å¢ï¼Œé»˜è®¤False                                                               |
| --quad            | quad dataloader                                     | å››å…ƒæ•°æ®åŠ è½½å™¨ å¼€å¯ä¹‹ååœ¨å°ºå¯¸å¤§äº640çš„å›¾åƒä¸Šè¯†åˆ«æ•ˆæœæ›´å¥½ï¼Œä½†æ˜¯æœ‰å¯èƒ½ä¼šä½¿åœ¨640å°ºå¯¸çš„å›¾ç‰‡ä¸Šæ•ˆæœæ›´å·® |
| --cos-lr          | cosine LR scheduler                                 | æ˜¯å¦é‡‡ç”¨é€€ç«ä½™å¼¦å­¦ä¹ ç‡ï¼Œé»˜è®¤False                                                                 |
| --label-smoothing | Label smoothing epsilon                             | æ ‡ç­¾å¹³æ»‘                                                                                         |
| --patience        | EarlyStopping patience (epochs without improvement) | æ—©åœæœºåˆ¶ï¼Œé»˜è®¤False                                                                               |
| --freez           | Freeze layers: backbone=10, first3=0 1 2            | å†»ç»“å±‚æ•°ï¼Œé»˜è®¤ä¸å†»ç»“                                                                              |
| --save-period     | Save checkpoint every x epochs (disabled if < 1)    | ç”¨äºè®°å½•è®­ç»ƒæ—¥å¿—ä¿¡æ¯ï¼Œint å‹ï¼Œé»˜è®¤ -1                                                              |
| --seed            | Global training seed                                | éšæœºæ•°ç§å­è®¾ç½®                                                                                       |
| --local_rank      | Automatic DDP Multi-GPU argument, do not modify     | è‡ªåŠ¨å•æœºå¤šå¡è®­ç»ƒ ä¸€èˆ¬ä¸æ”¹åŠ¨                                                                      |




## å‚è€ƒæ–‡ç« 
- https://github.com/ultralytics/yolov5/wiki/Train-Custom-Data
- https://docs.ultralytics.com/quick-start/
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="quick_start.html" class="md-footer__link md-footer__link--prev" aria-label="ä¸Šä¸€é¡µ: 4. å¿«é€Ÿå¼€å§‹" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                ä¸Šä¸€é¡µ
              </span>
              4. å¿«é€Ÿå¼€å§‹
            </div>
          </div>
        </a>
      
      
        
        <a href="TTA.html" class="md-footer__link md-footer__link--next" aria-label="ä¸‹ä¸€é¡µ: 6. æµ‹è¯•æ—¶å¢å¼º (TTA)" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                ä¸‹ä¸€é¡µ
              </span>
              6. æµ‹è¯•æ—¶å¢å¼º (TTA)
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.top", "instant"], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.477d984a.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.ddd52ceb.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>